<div id="reportinst_box" class="easyui-layout" style="width:100%;height:100%">
    <div data-options="region:'north',title:'North Title',split:true" style="height:10%;">
        <form class="" style="height: 100%;padding: 4px" >
            <label class="gui-form-label">报表：</label>
            <div class="">
                <input type="text" name="id" style="width:400px"/>
                <span style="margin-left: 20px" class="yM none">
                    <label >年度：</label>
                    <input type="text" name="year" style="width:80px"/>
                    <label class="">月份</label>
                        <input type="text" name="month" style="width:60px"/>
			    </span>
                <span class="rq none">
                    <label>日期</label>
                    <input type="text" name="date" style="width:120px"/>
                </span>
                <input type="hidden" name="bblx">
                <a class="report-chart-search toolbar l-btn l-btn-small l-btn-plain" href="javascript:void(0)"  style="height: 34px;margin-left: 20px">
				    <span class="l-btn-left l-btn-icon-left" style="margin-top: 5px;">
					<span class="l-btn-text">查询</span><span class="l-btn-icon fa fa-search">&nbsp;</span></span>
                </a>
            </div>
        </form>
        </div>
    <div data-options="region:'center',title:'center title'" style="padding:5px;height: 90%;border-top: 1px lightgrey solid;position: relative;">
        <div style="width:100%;height: 100%;">
            <iframe  style="width: 100%;height: 100%"></iframe>
        </div>
    </div>
</div>
<script>
    $(function () {

        var $box = $('#reportinst_box');
        $('#reportinst_box').find('input[name=id]').iCombobox({textField:"bbmc",valueField:"id",panelHeight:300,onSelect:function (data) {
                $box.find('.yM').removeClass("none");$box.find('.rq').removeClass("none");
                $box.find("input[name='bblx']").val(data.bblx);
                if(data.bblx=="D"){
                    $box.find('.yM').addClass("none");

                }else if(data.bblx=="M"){
                    $box.find('.rq').addClass("none");

                }
            }});
        $('#reportinst_box').find('input[name=date]').iDatebox({});
        HTTP.post("report/reporttemp/query",{},function (result) {
            if(result["success"]&&result["data"])
                $box.find('input[textboxname="id"]').combobox("loadData",result["data"]["records"]);
            if(result["data"]["records"][0])
                $box.find('input[textboxname="id"]').combobox({value:result["data"]["records"][0]["id"]});
            $box.find('input[textboxname="id"]').combobox("setText",result["data"]["records"][0]["bbmc"]);
            var data=result["data"]["records"][0];
            $box.find('.yM').removeClass("none");$box.find('.rq').removeClass("none");
            $box.find("input[name='bblx']").val(data.bblx);
            if(data.bblx=="D"){
                $box.find('.yM').addClass("none");

            }else if(data.bblx=="M"){
                $box.find('.rq').addClass("none");

            }
        });

        $box.find('input[name=year]').iCombobox({textField:"text",valueField:"value",
            data:[{value:"2019", text:"2019"},
                {value:"2020", text:"2020"},
                {value:"2021", text:"2021"},
                {value:"2022", text:"2022"},
                {value:"2023", text:"2023"},
                {value:"2024", text:"2024"},
                {value:"2025", text:"2025"},
                {value:"2026", text:"2026"},
                {value:"2027", text:"2027"},
                {value:"2028", text:"2028"},
                {value:"2029", text:"2029"},
                {value:"2030", text:"2030"}
            ]
        });

        $box.find('input[name=month]').iCombobox({textField:"text",valueField:"value",
            data:[{value:"1", text:"1"},
                {value:"2", text:"2"},
                {value:"3", text:"3"},
                {value:"4", text:"4"},
                {value:"5", text:"5"},
                {value:"6", text:"6"},
                {value:"7", text:"7"},
                {value:"8", text:"8"},
                {value:"9", text:"9"},
                {value:"10", text:"10"},
                {value:"11", text:"11"},
                {value:"12", text:"12"}
            ]
        });
        var date=new Date();
        HTTP.post('common/datetime',{},function (result) {
            if(result['success']&&result['data']['data']){
                date=result["data"]["data"];
                $box.find('input[textboxname=year]').combobox({value:new Date(date).getFullYear()});
                $box.find('input[textboxname=month]').combobox({value:new Date(date).getMonth()+1});
            }
        });
        $box.find('.report-chart-search ').unbind().bind("click",function () {
            var iframe=$box.find('iframe');
            var parms={};
            var data=DataBind.collectData($('#reportinst_box').find('form'));
            parms.id=data.id;
            if(data["bblx"]&&data["bblx"]=="M"){
                parms.year=parseInt(data.year);
                parms.month=parseInt(data.month);
            }
            if(data["bblx"]&&data["bblx"]=="D"){
                parms.bbrq =new Date(data.date).getTime()
            }
            iframe.html('');
            HTTP.post("report/reportinst/query/bbnr",parms,function (result) {
                if(result["success"]&&result["data"]["records"]){
                    if(result["data"]["records"]["id"]){
                        iframe.attr("src",'report/reportinst/display/v2/'+result["data"]["records"]["id"]);
                    }
                }else{
                    $.messager.alert("提示",result["message"]||"服务器失败");
                }

            })


        });


    });

</script>