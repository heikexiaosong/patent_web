<div  style="background-color:#040f3c;" class="main_box clearfix">
    <div class="header" style="">综合指标展示
    </div>
    <div class="main">
        <div class="main-middle">
            <div class="border-container" style="width: 80%;float: left;">
                <ul id="map">
                    <!--<table>
                        <thead>
                        <tr>
                            <th></th>
                            <th>烧结矿</th>
                            <th>生铁</th>
                            <th>钢坯</th>
                            <th>钢材</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr style="color: red">
                            <td>月累计</td>
                            <td>20000</td>
                            <td>11313</td>
                            <td>32878</td>
                            <td>31212</td>
                        </tr>
                        <tr>
                            <td>月目标</td>
                            <td>12120</td>
                            <td>7030</td>
                            <td>28988</td>
                            <td>26313</td>
                        </tr>
                        <tr>
                            <td>完成率</td>
                            <td>60.6%</td>
                            <td>62.14%</td>
                            <td>88.17%</td>
                            <td>84.12%</td>
                        </tr>
                        </tbody>
                    </table>-->
                    <li style="display: inline-block">
                        <div  id="mapPie1" style="height:160px;width:60%"></div>
                        <div class="pie_box">
                            <h4>烧结矿</h4>
                            <h3><span style="font-size: 12px">月目标 </span>20000</h3>
                            <h3 style="color: greenyellow"><span style="font-size: 12px;color: white">月累计 </span>12120</h3>
                        </div>
                    </li>
                    <li style="display: inline-block"><div id="mapPie2" style="height:160px;width:60%"></div>
                        <div class="pie_box">
                            <h4>生铁</h4>
                            <h3><span style="font-size: 12px">月目标 </span>11313</h3>
                            <h3 style="color: greenyellow"><span style="font-size: 12px;color:white">月累计 </span>7030</h3>
                        </div>
                    </li>
                    <li style="display: inline-block"><div id="mapPie3" style="height:160px;width:60%"></div>
                        <div class="pie_box">
                            <h4>钢坯</h4>
                            <h3><span style="font-size: 12px">月目标 </span>32878</h3>
                            <h3 style="color: greenyellow"><span style="font-size: 12px;color: white">月累计 </span>28988</h3>

                        </div></li>
                    <li style="display: inline-block"><div id="mapPie4" style="height:160px;width:60%"></div>
                        <div class="pie_box"><h4>钢材</h4>
                        <h3><span style="font-size: 12px">月目标 </span>31212</h3>
                        <h3 style="color: greenyellow"><span style="font-size: 12px;color:white">月累计 </span>26313</h3></div></li>

                </ul>
                <span class="top-left border-span"></span>
                <span class="top-right border-span"></span>
                <span class="bottom-left border-span"></span>
                <span class="bottom-right border-span"></span>
            </div>
            <div class="main-right" style="width: 20%">
                <div class="border-container" >
                    <div id="map1" style="height: 180px">
                        <div class="number-show">
                            <ul>
                                <li>
                                    <span class="span-name">钢材价格</span><span class="span-number-show">4100.00</span>
                                </li>
                                <li>
                                    <span class="span-name">钢材销量</span><span class="span-number-show">2333.33</span>
                                </li>
                                <li>
                                    <span class="span-name">利润总额</span><span class="span-number-show">2323242</span>
                                </li>
                                <li>
                                    <span class="span-name">吨产品利润</span><span class="span-number-show">343433</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <span class="top-left border-span"></span>
                    <span class="top-right border-span"></span>
                    <span class="bottom-left border-span"></span>
                    <span class="bottom-right border-span"></span>
                </div>
            </div>
        </div>
        <div class="main-middle" style="height: 40%;">
            <div class="border-container" style="width: 50%;float: left;height: 100%;display: inline-block">
                <div id="sample_1" style="height:240px"></div>
                <span class="top-left border-span"></span>
                <span class="top-right border-span"></span>
                <span class="bottom-left border-span"></span>
                <span class="bottom-right border-span"></span>
            </div>
            <div class="main-right" style="width: 50%;display: inline-block">
                <div class="border-container" >
                    <div id="sample_table_1" style="height: 240px"></div>
                    <span class="top-left border-span"></span>
                    <span class="top-right border-span"></span>
                    <span class="bottom-left border-span"></span>
                    <span class="bottom-right border-span"></span>
                </div>
            </div>
        </div>
        <div class="main-middle">
            <div class="border-container" style="width: 50%;float: left;">
                <div id="sample_2" style="height: 240px"></div>
                <span class="top-left border-span"></span>
                <span class="top-right border-span"></span>
                <span class="bottom-left border-span"></span>
                <span class="bottom-right border-span"></span>
            </div>
            <div class="main-right" style="width: 50%">
                <div class="border-container" >
                    <div id="sample_table_2" style="height: 240px"></div>
                    <span class="top-left border-span"></span>
                    <span class="top-right border-span"></span>
                    <span class="bottom-left border-span"></span>
                    <span class="bottom-right border-span"></span>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="GUI/static/plugins/echarts/theme/dark.js"></script>
<script src="GUI/static/plugins/echarts/theme/macarons.js"></script>
<script>
    $(function () {
        $(".main_box").parent(".panel-body").css("background","rgb(4, 15, 60)")
        var chart = echarts.init($('#sample_1')[0], 'dark');
        HTTP.post('report/chart/config/1',{},function (result) {
            if(result["success"]){
                var config=result["data"]["config"];
                var option = {
                    title: {
                        text: config.name,
                        left:'center',
                        y:10
                    },
                    tooltip : {
                        trigger: 'axis'
                    },
                    xAxis : [
                        {
                            type : 'category',
                            boundaryGap : false,
                            data : []
                        }
                    ],
                    yAxis : [
                        {
                            type : 'value',
                            scale:true
                        }
                    ],
                    series : []
                };
                chart.setOption(option);
                var columns=[];
                columns.push({
                    field:"time",title:"日期",width:120,align:"center",
                });

                $.each(config.items,function (i,item) {
                    columns.push(
                        {title: item.name, field:item.id,align:"center", width:100/(config.items.length+1)+"%"}
                    )
                });
                $('#sample_table_1').datagrid({
                    columns:[columns],
                    singleSelect:true,
                    /*         pagination:true*/
                });

                reportTimeRer(chart,"report/chart/loaddata/1",
                    {})

            }
        },null,true);

        var chart2 = echarts.init($('#sample_2')[0], 'dark');
        HTTP.post('report/chart/config/1',{},function (result) {
            if(result["success"]){
                var config=result["data"]["config"];
                var option = {
                    title: {
                        text:"加工成本",
                        left:'center',
                        y:10
                    },
                    tooltip : {
                        trigger: 'axis'
                    },
                    xAxis : [
                        {
                            type : 'category',
                            boundaryGap : false,
                            data : []
                        }
                    ],
                    yAxis : [
                        {
                            type : 'value',
                            scale:true
                        }
                    ],
                    series : []
                };
                chart2.setOption(option);
                var columns=[];
                columns.push({
                    field:"time",title:"日期",width:120,align:"center",
                });

                $.each(config.items,function (i,item) {
                    columns.push(
                        {title: item.name, field:item.id,align:"center", width:100/(config.items.length+1)+"%"}
                    )
                });
                $('#sample_table_2').datagrid({
                    columns:[columns],
                    singleSelect:true
                });

                reportTimeRer2(chart2,"report/chart/loaddata/1",
                    {})

            }
        },null,true);
        reportPie($('#mapPie1')[0],60.6);
        reportPie($('#mapPie2')[0],62.14);
        reportPie($('#mapPie3')[0],88.17);
        reportPie($('#mapPie4')[0],84.12);

        function reportTimeRer(chart,url,params){
            if(!chart){
                return;
            }
            HTTP.post(url,params||{year:2019, month:6},function (result) {
                if(result['success']){
                    var records=result['data']['trenddata'];
                    var datas=records['datas'];
                    var legend=[];var series=[];var datagrid_data=[];var map={}
                    $.each(records["items"],function (i,te) {
                        map[te.id]=te.name
                    });
                    var option = chart.getOption();

                    $.each(datas,function (n,dat) {
                        legend.push(map[n]);
                        series.push({
                            data:dat,type:"line",name:map[n]
                        });
                    });
                    option.legend={
                        orient:"vertical",
                        x:"right",
                        padding:10,
                        show:true,
                        data:legend
                    };
                    option.xAxis[0]["data"]=records["xaxis"];
                    option.series =series;
                    chart.setOption(option);

                    var length=records["xaxis"].length;

                    for(var i=0;i<length;i++){
                        var item={time:records["xaxis"][i]};
                        $.each(records.items,function (j,n) {
                            item[n.id]=datas[n.id][i];
                        });
                        datagrid_data.push(item);
                    }

                    $("#sample_table_1").datagrid("loadData",datagrid_data);

                }else{
                    $.messager.alert("提示",result["message"]||"返回数据错误,请重新打开页面");
                }
            },null,true);
        };
        function reportTimeRer2(chart,url,params){
            if(!chart){
                return;
            }
            HTTP.post(url,params||{year:2019, month:6},function (result) {
                if(result['success']){
                    var records=result['data']['trenddata'];
                    var datas=records['datas'];
                    var legend=[];var series=[];var datagrid_data=[];var map={}
                    $.each(records["items"],function (i,te) {
                        map[te.id]=te.name
                    });
                    var option = chart.getOption();

                    $.each(datas,function (n,dat) {
                        legend.push(map[n]);
                        $.each(dat,function (i,item) {
                            dat[i]=item*0.01
                        });
                        series.push({
                            data:dat,type:"line",name:map[n]
                        });
                    });
                    option.legend={
                        orient:"vertical",
                        x:"right",
                        padding:10,
                        show:true,
                        data:legend
                    };
                    option.xAxis[0]["data"]=records["xaxis"];
                    option.series =series;
                    chart.setOption(option);

                    var length=records["xaxis"].length;

                    for(var i=0;i<length;i++){
                        var item={time:records["xaxis"][i]};
                        $.each(records.items,function (j,n) {
                            item[n.id]=datas[n.id][i];
                        });
                        datagrid_data.push(item);
                    }

                    $("#sample_table_2").datagrid("loadData",datagrid_data);

                }else{
                    $.messager.alert("提示",result["message"]||"返回数据错误,请重新打开页面");
                }
            },null,true);
        };

        function reportPie(ele,value) {
            var chart3 = echarts.init(ele,'macarons');
           var  option3= {
                tooltip : {
                    formatter: "{a} <br/>{b} : {c}%"
                },
                series : [
                    {
                        name:'指标',
                        title : {
                            show : false,
                        },
                        type:'gauge',
                        detail : {formatter:'{value}%',
                            textStyle : { // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                                color : 'auto',
                                fontWeight : 'bolder',
                                fontSize :18
                            },},
                        data:[{value: value, name: '完成率'}],
                        pointer: {
                            width:1,//指针的宽度
                            length:"60%", //指针长度，按照半圆半径的百分比
                            shadowColor : '#ccc', //默认透明
                            shadowBlur: 5
                        },
                        axisLabel: {            // 坐标轴小标记
                            textStyle: {       // 属性lineStyle控制线条样式
                                color: '#000',
                                fontSize: 9,
                                shadowColor: '#000'
                            }},
                        axisTick : { // 坐标轴小标记
                            splitNumber :5, // 每份split细分多少段
                        }
                      /*  splitLine : { // 分隔线
                            show : false,
                        },
                        splitNumber : 0,*/
                    },

                ],

            };
            chart3.setOption(option3);
        }




    })

</script>